bundle agent __main__
{
  methods:
      "northerntech_security_hardening:cve_2021_3156";
}

body file control
{
        namespace => "northerntech_security_hardening";
}

bundle agent cve_2021_3156
{
  vars:
      "_sudoedit"
        string => ifelse(
                          fileexists( "/usr/bin/sudoedit" ), "/usr/bin/sudoedit",
                          "/sbin/sudoedit"
        );

      "_action"
        string => ifelse( "default:cve_2021_3156_remediate|northerntech_security_hardening:cve_2021_3156_remediate",
                          "fix",
                          "warn");

    cve_2021_3156_vulnerable::

      "vulnerable"
        string => "CVE-2021-3156",
        meta => { "inventory", "attribute_name=CVE" };

  classes:

      "cve_2021_3156_vulnerable"
        scope => "namespace",
        expression => strcmp( "sudoedit: /: not a regular file",
                              execresult( "$(_sudoedit) -s /", "noshell" ));

  packages:

    cve_2021_3156_vulnerable::

      "sudo"
        policy => "present",
        version => "latest",
        action => default:policy( "$(_action)" );
}
